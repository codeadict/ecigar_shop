(function(){var h=!1,r=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(e){function n(){!h&&this.init&&this.init.apply(this,arguments)}var a=this.prototype;h=!0;var b=new this;h=!1;for(var c in e)b[c]="function"==typeof e[c]&&"function"==typeof a[c]&&r.test(e[c])?function(b,c){return function(){var e=this._super;this._super=a[b];var f=c.apply(this,arguments);this._super=e;return f}}(c,e[c]):e[c];n.prototype=b;n.prototype.constructor=n;n.extend=arguments.callee;
return n}})();
(function(h,r){var e,n;h.BaseGraph=h.Class.extend({init:function(a){var b={w:700,h:350,pad:[10,10,10,10],lblPad:8,comp:{},pop:{},disablePop:!1,rotate:0,tickFontSize:13,groups:[],rcq:null,stack:0,showLegend:1,lineHeight:1.2,showActions:!1,colorIndex:-1,onItemClick:$.noop,clickedItems:[],seriesDisabled:[],ldata:[],idMap:{},idInc:0};e||n();$.extend(this,b,a);a.$ele&&(this.ele=a.$ele[0]);this.build();return this},loading:function(a){a?this.spinner=this.$ele.spin({color:"#999",corners:0,width:3}).find(".spinner"):
this.spinner&&this.spinner.fadeOut(function(){$(this).remove()})},error:function(){if(this.onError)return this.onError();var a=this.$ele;this.$tbl?a&&a.empty().height(0):this.$err||(this.$err=$('<div class="gfx-error-wrap"><div class="gfx-error">'+tt("Woah! The visualization could not be rendered, sorry about that!")+"</div></div>").hide().appendTo(a).fadeIn(500),FTB.Analytics.error("Visualization Could Not Render"))},resetError:function(){var a=this;a.$err&&(a.$err.fadeOut(500),setTimeout(function(){a.$err.remove();
a.$err=null},500))},destroy:function(){this.$tbl&&(this.$tbl.find("tr").each(function(){this.firstChild.style.borderLeftWidth=0}),this.$tbl.find("th").css("borderTop",0),this.$tbl.off("mouseenter.gfx","**").off("mouseleave.gfx","**"),this.$ele&&this.$ele.parent().off("mouseleave.gfx","**"));this.pop&&this.pop.e&&this.pop.e.remove();this.svg.remove();this.loading(!1);this.legend&&this.legend.remove();return this},build:function(){this.svg=e.select(this.ele).append("svg").classed(this.gfxClass,!0);
this.$tbl&&this.initTable();return this},update:function(){if(!this.data||null===this.primary||!this.series)return this.error(),!1;this.highlightFeatured()},setData:function(a){var b=this,c=0,d,k={},e=[];if(null===this.primary||!this.series)return this.error(),!1;a=this.comp=a||this.comp;this.setColorField(this.colorField);var f=/^-?[0-9\.%]+$/;$.each(a.data,function(g,m){var p,w=1;if(p=f.test(m[b.primary])?parseFloat(m[b.primary]):m[b.primary])p={d:b.series.map(function(a,b,g){g=m[a];if(null===g||
g===r||""===g)return null;w=0;return f.test(g)?parseFloat(g):g}),t:p,ci:g},1<=b.colorIndex&&(p.c=f.test(m[b.colorIndex])?parseFloat(m[b.colorIndex]):m[b.colorIndex]),b.showImg&&0<=a.img_index&&(p.img=a.get_img_info(g,"t"),1!==p.img.d&&(c=1)),d=m[a.id_index],d="-1"===d?p.t:d,p.id=k[d]=b.idMap.hasOwnProperty(d)?b.idMap[d]:b.idInc++,w||e.push(p)});this.data=e;this.hasImg=c;this.idMap=k;var g=this.inverseIdMap={};$.map(this.idMap,function(a,f){g[a]=f});if(!e.length)return this.error(),!1;this.resetError()},
setDataCommon:function(){var a=this.data||[];if(this.isOrdinalDate||this.timeAxis)this.parseDate(),this.ensureDataOrder();this.odata=a.map(function(a){return a.t});this.ldata=[];this.setLayerData();this.setExtent();this.setColors().setDomains().setLegend()},setExtent:function(){var a=0===this.stack,b=a?function(a){return a.y}:function(a){return a.y0+a.y};this.extent=e.extent(e.merge(this.ldata.map(function(a){return e.merge(a.map(b))})));a||(this.extent[0]=0);return this},setVizTemplate:function(a){a=
this.ghead=a||this.ghead||[];var b=[],c=this.comp.head||[];a.forEach(function(a){a=c.indexOf(a);0<=a&&b.push(a)});this.primary=b[0];this.series=b.slice(1);this.seriesDisabled.length=0;return this},setColorField:function(a){if(a&&(a=(this.comp.head||[]).indexOf(a),0<=a)){this.colorIndex=a;this.colorViz=viz.get(this.comp.defs[a]);return}this.colorIndex=-1},getColorForValue:function(a){a=this.colorViz.getPercent(a);return this.colorViz.getColor(a)},isGroup:function(){return 0===this.stack},setLayerData:function(){var a=
this,b=a.data||[],c=e.layout.stack();2===this.stack?c.offset("expand"):3===this.stack&&c.offset("silhouette");a.ldata=e.transpose(b.map(function(a,b){return a.d.map(function(c,f){return{x:b,y:c,id:a.id,ci:a.ci,c:f}})}));a.totalLayers=a.ldata.length;a.ldata=a.ldata.filter(function(b,c){return!a.seriesDisabled[c]});if(!a.ldata.length)return a;a.ldata=c(a.ldata);a.ldata.forEach(function(b,c){a.ldata[c]=b.filter(function(a){return null!==a.y})});a.ldata=a.ldata.filter(function(a){return!!a.length});return a},
colorize:function(a){var b=this;a&&a.attr("fill",function(a){return b.c[a[0].c]});if(b.$tbl){var c={};b.series.forEach(function(a,e){c[a]=b.c[e]});b.colorTableCols(c)}},setColors:function(){var a=this.totalLayers||1,b=e.hsl(this.theme),c=4<a?Math.ceil(a/2)-1:0,d=e.scale.linear().domain([0,c]).range([String(b.brighter(1)),this.theme]),k=e.scale.linear().domain([c,a-1]).range([this.theme,String(b.darker(1))]);this.c=e.range(a).map(function(a){return a<c?String(d(a)):String(k(a))});return this},getVisibleRangeFields:function(){var a=
this;return a.series.filter(function(b,c){return!a.seriesDisabled[c]})},queueListing:function(a){var b=this.inverseIdMap[this.data[a].id];this.rcq&&this.rcq.contains(b)?this.rcq.remove(b):this.rcq&&0<=b&&this.comp.rcq_add(this.rcq,a,"t")},itemClicked:function(a,b){var c=!0,d=$.inArray(a.ci,this.clickedItems);0<=d?(this.clickedItems.splice(d,1),c=!1):this.clickedItems.push(a.ci);this.showActions&&this.loadActionBox(a,c,b)},loadActionBox:function(a,b,c){var d=this,k=e.select(c);c=function(){d.disablePop=
!1;d.highlight(!1);d.clickedItems=[];k.classed("gfx-clicked",!1);setTimeout(function(){d.$ele.removeClass("gfx-selected")},250)};var l=function(a){d.actionBtnClick(a)},f=function(){var a=d.pop.e.position(),f=d.pop.e.offset(),b=d.pop.e.height();d.pop.b_height=d.pop.b_height||d.$ele.height();d.pop.b_off=d.pop.b_off||d.$ele.offset();d.pop.b_height<f.top-d.pop.b_off.top+b&&d.pop.e.css("top",a.top+d.pop.b_height-(f.top-d.pop.b_off.top+b))};e.selectAll($(".gfx-clicked")).classed("gfx-clicked",!1).classed("gfx-sel",
!1);d.bota&&(d.bota.destroy(),delete d.bota);b?(k.classed("gfx-clicked",!0),d.disablePop=!1,d.highlight(k),d.highlightTable(a.id),d.disablePop=!0,d.clickedItems=[a.ci],d.$ele.addClass("gfx-selected"),f(),EVT(["Visualization","Clicked item on graph",FTB.page_type,time_on_site(),!1]),cancelEvent(e.event),$d.off("click",".gfx-selected").one("click",".gfx-selected",c).off("click",".gfx-act .act-btn-wrap").on("click",".gfx-act .act-btn-wrap",l)):c()},actionBtnClick:function(a){var b=a.currentTarget,c=
$(b).data("action"),d=this,e=d.clickedItems,l=e[0],f=d.inverseIdMap[d.data[l].id];switch(c){case "rcq":EVT(["Visualization","Item action: Compare",FTB.page_type,time_on_site(),!1]);$.each(e,function(a,f){d.queueListing(f)});break;case "save":EVT(["Visualization","Item action: Save",FTB.page_type,time_on_site(),!1]);d.bota=h.ftb_list.show(f,d.data[l].t,b,{closeOnBody:!0,app_id:d.comp.app_id||FTB.app_id});cancelEvent(a);break;case "dd":f&&(EVT(["Visualization","Item action: DD",FTB.page_type,time_on_site(),
!1]),a=_.size(d.comp.urls)?d.comp.urls[l]:d.comp.get_detail_url(l),h.open(a));break;case "embed":h.embed({type:"detail",ids:[f],source:FTB.page_type+" viz action"});break;default:cancelEvent(a)}},d3ifyPoints:function(a){return e.selectAll(a)},showPop:function(a){this.pop.e||this.buildPop();var b=this.getPopHTML(a);if(b)return this.pop.e.html(b).show(),a=this.getPopXY(a.bbox()),this.pop.e.css({left:a[0],top:a[1],opacity:1}),this},hidePop:function(){if(!this.disablePop)return this.pop.e&&this.pop.e.css({opacity:0}),
this},buildPop:function(){var a=this;a.pop.e=$('<div class="gfx-pop border-box t05"/>').hide().hover(function(){clearTimeout(a.pop.t)},function(){a.pop.t=setTimeout(function(){a.hidePop()},100)}).appendTo(a.$ele);return this},getPopContent:function(a){var b=this,c=a.data()||[],d=b.comp,e=[],l="";if(!c.length)return null;$.each(c||[],function(a,g){a=b.series[g.c];var q=[d.defs[a].name,b.getPopValue(a,g.y)];1<c.length&&q.push(b.c[g.c]);e.push(q)});l=b.timeAxis?this.formatDateString(b.odata[c[0].x],
b.dateFormat):b.odata[c[0].x];return{t:l,v:e,c:a.fill()}},formatDateString:function(a,b){var c=this.getJSDateFormat(b),c=c.replace(/%Y/g,a.getFullYear()),c=c.replace(/%B/g,this.getMonthString(a.getMonth())),c=c.replace(/%d/g,this.makeTwoDigits(a.getDate())),c=c.replace(/%m/g,this.makeTwoDigits(a.getMonth()+1)),c=c.replace(/%y/g,(a.getFullYear()+"").slice(2)),c=c.replace(/%I/g,a.getHours()%12),c=c.replace(/%H/g,a.getHours()),c=c.replace(/%M/g,this.makeTwoDigits(a.getMinutes())),c=c.replace(/%p/g,12<
a.getHours()?"pm":"am");return c=c.replace(/%S/g,this.makeTwoDigits(a.getSeconds()))},makeTwoDigits:function(a){return 10>a?"0"+a:a},getMonthString:function(a){return"January February March April May June July August September October November December".split(" ")[a]},getJSDateFormat:function(a){a=a.replace(/\^/g,":");a=a.replace(/(\w)/g,"%$1");a=a.replace(/F/g,"B");a=a.replace(/g/g,"I");a=a.replace(/i/g,"M");a=a.replace(/a/g,"p");return a=a.replace(/s/g,"S")},normalizeValue:function(a,b,c){/^-/.test(a)&&
1===b.length&&(a="-"+b+a.substr(1),b="");return b+a+c},getPopValue:function(a,b){var c=this.comp,d=c.defs[a].prefix||"",e=c.defs[a].suffix||"";if(null===b||isNaN(b))return"&mdash;";b=""+Math.round(100*parseFloat(b,10))/100;c.defs[a].add_commas&&(b=add_commas(b));return this.normalizeValue(b,d,e)},getPopHTML:function(a){a=this.getPopContent(a);var b="",c="";if(a){a.t&&(b+='<div class="gfx-pop-title">'+a.t+"</div>");a.s&&(b+='<div class="gfx-pop-st">'+a.s+"<div>");$.each(a.v||[],function(a,b){var f=
b[2]?' style="border-left:4px solid '+b[2]+'"':"";c+='<tr class="gfx-pop-val"><td><div'+(f?' class="clr" '+f:"")+">"+b[0]+"</div></td><td>"+b[1]+"</td></tr>"});var d=(a.v||[]).length;c&&(b+='<table style="font-size:'+(10<d?10:5<d?11:3<d?12:13)+'px;">'+c+"</table>");this.showActions&&(b+=this.getActionHTML([{k:"rcq",v:tt("Compare"),c:!!this.rcq},{k:"save",v:tt("Save"),c:!!h.ftb_list},{k:"dd",v:tt("See Details"),c:!0},{k:"embed",v:tt("Embed"),c:!FTB.IS_WIDGET}]));return'<div class="gfx-pop-i'+(a.c?
' clr" style="border-color:'+a.c+'"':'"')+">"+b+"</div>"}},getActionHTML:function(a){return'<div class="gfx-act"><div class="act-wrap">'+_.map(a,function(a){return a.c?'<div class="act-btn-wrap" data-action="'+a.k+'"><span class="'+a.k+'-icon spr"></span><div class="act link">'+tt(a.v)+"</div></div><br/>":""}).join("")+"</div></div>"},getPopXY:function(a){var b=this.pop.e,c=b.outerWidth(),b=b.outerHeight(),d=this._pad||[0,0,0,0],e=this.pad,l=a.x+d[3],f=l+a.w,d=a.y+d[0];a=d+a.h;if(this.w-f-20-e[1]>
c)c=f+10,b=Math.min(d,this.h-b-e[3]);else if(this.h-a-20-e[3]>b)c=Math.min(l,this.w-c-e[2]),b=a+10;else if(0<l-c-20-e[0])c=l-c-10,b=Math.min(d,this.h-b-e[3]);else if(0<d-b-20-e[1])c=Math.min(l,this.w-c-e[2]),b=d-b-10;else return[e[3],e[0]];return[Math.floor(c),Math.floor(b)]},highlight:function(a){var b=this,c=b.pop;if(!b.disablePop){b.$tbl&&b.$tbl.find(".gfx-srp-hlt").removeClass("gfx-srp-hlt");b.onHighlight&&b.onHighlight.call(b,a);if(a)return b.$ele.addClass("gfx-pop-overlay"),c._active=!0,c.p=
a,clearTimeout(c.t),b.highlightPoints(a),1===a.length&&b.showPop(a),this;c.t=setTimeout(function(){c._active||b.hidePop();b.$ele.removeClass("gfx-pop-overlay")},100);b.highlightPoints(c.p,!0);c._active=!1}},highlightFeatured:_.debounce(function(){if(this.featured){var a=this.svg.selectAll(".gfx-id-"+this.idMap[this.featured]);a[0].length&&(this.highlight(a),this.featured=0)}},1E3),highlightPoints:function(a,b){if(a)return a.classed("gfx-sel",!b),this},initTable:function(){var a=this;if(a.$tbl)return a.$tbl.on("mouseleave.gfx",
"tr",function(){a.highlight(!1)}).on("mouseenter.gfx","tr",function(){var b=$(this).data("id"),b=isNaN(b)?void 0:a.idMap[b];void 0!==b&&a.highlight(a.svg.selectAll(".gfx-id-"+b))}),a.$ele.parent().on("mouseleave.gfx",function(){a.highlightTable(!1)}),this},colorTableCols:function(a){if(this.$tbl){var b=this.$tbl.find(".floating-header");(b.length?b:this.$tbl).find("th").each(function(b){$(this).css("borderTop",a[b]?"3px solid "+a[b]:0)});return this}},highlightTable:function(a){a=this.inverseIdMap[a];
if(this.$tbl&&a&&!this.disablePop){var b=(a=a?this.$tbl.find(".item-row"+a).addClass("gfx-srp-hlt"):!1)&&a.length?a.position().top:0,c=this.$tblhd=this.$tblhd||this.$tbl.find(".floating-header"),d=this.$tblscrl=this.$tblscrl||this.$tbl.find(".sx-overview"),b=a?c.height()-b:0;d.stop().animate({top:b+"px"});return this}},checkOrdinalDate:function(){if(-1!==this.comp.head[this.primary].toLowerCase().indexOf("year")&&/^\d+$/.test(this.comp.data[0][this.primary]))return this.dateFormat="Y",!0},parseDate:function(){var a=
this,b=this.getJSDateFormat(this.dateFormat),c=e.time.format(b).parse;a.data.forEach(function(b){b.date=c(b.t+"");a.timeAxis&&(b.t=b.date)})},timeFormat:function(a){var b=this;return function(c){for(var d=a.length-1,e=a[d];!e[1](c);)e=a[--d];b.tickLevels.push(d);return e[0](c)}},ensureDataOrder:function(){this.data.sort(function(a,b){return a.date>b.date?1:a.date<b.date?-1:0})},setLegend:function(){var a=this,b=a.series,c="";a.legend&&a.legend.remove();if(2>b.length||!a.showLegend)return this;for(var d=
0,e=b.length;d<e;d++)c+='<div class="gfx-lgnd-i" data-series="'+d+'"><div class="gfx-lgnd-icn" style="background-color:'+a.c[d]+'"/><div class="gfx-lgnd-txt">'+a.comp.defs[b[d]].name+"</div></div>";a.legend=$('<div class="gfx-lgnd">'+c+"</div>").appendTo(a.$ele);a.legend.find(".gfx-lgnd-i").on("click",function(){var b=+$(this).toggleClass("off").data("series");a.seriesDisabled[b]=!a.seriesDisabled[b];a.setLayerData().setExtent().setDomains().resize().update()});return this}});n=function(){e=h.d3;
var a=e.selection.prototype;a.front=function(){return this.each(function(){this.parentNode.appendChild(this)})};a.dim=function(){var a=this.node().getBBox();return[a.width,a.height]};a.jq=function(){return $(this.node())};a.trans=function(a,c,d){if(!a)return this;d=this.transition().duration(a);return c?d.delay(function(a,b){return b*c}):d};a.bbox=function(){var a,c,d,e;this.each(function(l,f){var g=this.getBBox(),q=g.x+g.width,m=g.y+g.height;a=f?Math.min(g.x,a):g.x;c=f?Math.min(g.y,c):g.y;d=f?Math.max(q,
d):q;e=f?Math.max(m,e):m});return{w:d-a,h:e-c,x:a,y:c}};a.fill=function(){return 1===this[0].length?this.jq().css("fill"):null}}})(window);
(function(h,r){var e,n=/G$/,a,b,c,d,k,l=h.BaseGraph.extend({init:function(f){var g=this,c={pad:[20,20,10,10],tickLevels:[]};$.extend(c,f);g._super(c);e=h.d3;g.setVizTemplate();f=g.comp.defs[g.primary];g.isOrdinalDate=g.checkOrdinalDate();g.timeAxis=g.parseOrdinalDate&&("date"===f.control_type||g.isOrdinalDate);g.ordinalAxis=g.ordinal&&!g.timeAxis&&("number"!==f.data_type||"combo"===f.control_type);g.dateFormat=g.dateFormat||f.date_format;g.ordinal&&(g.o=e.scale.ordinal());g.x=g.timeAxis?e.time.scale():
g.ordinalAxis?e.scale.ordinal():e.scale.linear();g.y=e.scale.linear().nice().clamp(!0);f=e.svg.axis().scale(g.x);g.timeAxis?(a=a||b(),f.tickFormat(g.timeFormat(a))):f.tickFormat(function(a){return g.ordinalAxis?a:g.tickFormat(a)});c=e.svg.axis().scale(g.y).tickFormat(function(a){return 2===g.stack?100*a+"%":g.tickFormat(a)});g.rotate&&(f=[c,c=f][0],g.x=[g.y,g.y=g.x][0]);g.xxs=f.orient("bottom").tickPadding(8);g.yxs=c.orient("left").tickPadding(8);return g},destroy:function(){this._super();this.$ordinal&&
this.$ordinal.remove();return this},build:function(){this._super();this.buildAxes();return this},buildAxes:function(){var a=this;this.grid=this.svg.append("g");["x","y"].forEach(function(b){a[b+"tx"]=a.grid.append("g").attr({"class":"gfx-ticks gfx-axis-"+b});(a[b+"lbl"]=a.grid.append("g").attr({"class":"gfx-axis-label"})).append("text").classed("gfx-axis-text",!0).classed(b,!0)});this.ylbl.attr({transform:"rotate(-90)"});return this},isPrimaryAxis:function(a){return"x"===a&&!this.rotate||"y"===a&&
this.rotate},getAxisTpl:function(a){return this.isPrimaryAxis(a)?[this.primary]:this.getVisibleRangeFields()},updateAxis:function(a){var b=this,c=b[a+"lbl"],d=b.isPrimaryAxis(a),p=b.ordinalAxis&&d,k=b.timeAxis&&d,l=b[a+"tx"];"x"!==a||!b.rotate&&b.ordinalAxis||(b.tickHScale||(b.tickHScale=e.scale.linear().domain([200,2E3]).range([4,16])),b.xxs.ticks(Math.floor(b.tickHScale(b.iw||b.w))));"y"!==a||b.rotate&&b.ordinalAxis||(b.tickVScale||(b.tickVScale=e.scale.linear().domain([100,600]).range([4,10])),
b.yxs.ticks(b.tickVScale(b.ih||b.h)));var h=b.getAxisTpl(a);if(!h.length)return null;b.setMergeTicks(h);l.call(b[a+"xs"]);p&&(b.$ordinal&&b.$ordinal.remove(),b.$ordinal=b.getOrdinalTicks(),b.bindTickEvents(),b.$ele.append(b.$ordinal),b.resizeOrdinal());l.jq().showIf(!p);if(k){var s=e.extent(b.tickLevels);s[0]!==s[1]&&b.xtx.selectAll(".tick").each(function(a,f){e.select(this).classed("gfx-tick-major",b.tickLevels[f]===s[0])});b.tickLevels=[]}c._show=!b.ldata||2>b.ldata.length||2<b.txPref.length||2<
b.txSuff.length||d;c.jq().showIf(c._show);a=b.getAxisLabel(b.comp.defs[h[0]]);c.select(".gfx-axis-text").html(a);return b},setMergeTicks:function(a){this.txPref=d(this.comp.defs,"prefix",a);this.txSuff=d(this.comp.defs,"suffix",a);this.txCommas=d(this.comp.defs,"add_commas",a);this.txControlType=this.comp.defs[a[0]].control_type;this.txDataType=this.comp.defs[a[0]].data_type},getAxisLabel:function(a){var b=a.prefix||"",c=a.suffix||"";a=a.name;var d=[];2<b.length?d.push($.trim(b)):2<c.length&&d.push($.trim(b));
d=d.join("/");if(this.ldata&&1<this.ldata.length)return d;d&&(a+=" ("+d+")");return a},getTickSize:function(){return[0,0,this.$ordinal&&!this.rotate?this.$ordinal.outerHeight():this.xtx.dim()[1],this.$ordinal&&this.rotate?this.$ordinal.outerWidth():this.ytx.dim()[0]]},getLabelSize:function(){return[0,0,this.xlbl._show?this.xlbl.dim()[1]:0,this.ylbl._show?this.ylbl.dim()[1]:0]},getLegendSize:function(){return[0,0,this.legend?this.legend.outerHeight()+5:0,0]},enableSelectionBox:function(a){var b=this;
if(!1===a)b.svg.on("mousedown",null).on("mousemove",null).on("mouseup",null).on("click",null);else{if(b.ordinalAxis)return!1;b.svg.on("click",function(){b.svg.selectAll(".gfx-rect-sel").remove();b.disablePop=!1}).on("mousedown",function(){var a=e.mouse(this);b.svg.append("rect").attr({rx:6,ry:6,"class":"gfx-rect-sel",x:a[0],y:a[1],width:0,height:0});b.disablePop=!0}).on("mousemove",function(){var a=b.svg.select("rect.gfx-rect-sel");if(!a.empty()){var f=e.mouse(this),c={x:parseInt(a.attr("x"),10),
y:parseInt(a.attr("y"),10),width:parseInt(a.attr("width"),10),height:parseInt(a.attr("height"),10)},d=f[0]-c.x,k=f[1]-c.y,l=h.event||{};1>d||2*d<c.width?(c.x=f[0],c.width-=d):c.width=d;1>k||2*k<c.height?(c.y=f[1],c.height-=k):c.height=k;a.attr(c);l.metaKey||l.altKey||l.ctrlKey?e.selectAll("."+b.gfxClass+"-point.drag-collection").classed("gfx-drag-sel",!1):e.selectAll("."+b.gfxClass+"-point.gfx-drag-sel").classed("gfx-drag-sel",!1);b.getPointsInRect({x0:c.x,x1:c.x+c.width,y0:c.y,y1:c.y+c.height},"svg").filter(":not(.gfx-drag-sel)").classed("drag-collection",
!0).classed("gfx-drag-sel",!0)}}).on("mouseup",function(){b.dragSelectEnd&&b.dragSelectEnd(b.getSelectedData(),b.getBoxCoords());b.svg.selectAll(".drag-collection").classed("drag-collection",!1);b.svg.selectAll(".gfx-rect-sel").remove();b.disablePop=!1})}},clearSelectedData:function(){e.selectAll("."+this.gfxClass+"-point.gfx-drag-sel").classed("gfx-drag-sel",!1)},getSelectedData:function(){return e.selectAll(".gfx-drag-sel").data()},getBoxCoords:function(){var a=this.svg.select(".gfx-rect-sel");
this.x.invert(a.attr("x")-this._pad[3]);this.y.invert(a.attr("y")-this._pad[0]);return{x0:this.x.invert(a.attr("x")-this._pad[3]),x1:this.x.invert(+a.attr("x")-this._pad[3]+ +a.attr("width")),y0:this.y.invert(+a.attr("y")-this._pad[0]+ +a.attr("height")),y1:this.y.invert(a.attr("y")-this._pad[0])}},getPointsInRect:function(a,b,c){var d={},p=[],d=this.mapRectAreaToData(a,b,c);e.selectAll("."+this.gfxClass+"-point").each(function(a){a.d[0]>=d.x0&&a.d[0]<=d.x1&&a.d[1]>=d.y0&&a.d[1]<=d.y1&&p.push(this)});
return e.selectAll(p)},mapRectAreaToData:function(a,b,c){var d={},e=this.x.range(),k=this.y.range(),l=this.x.domain(),h=this.y.domain(),s={top:0,left:0};"dom"===b&&(s=this.svg.jq.offset());"svg"===b?(a.x0=a.x0||Math.min(e[0],e[1]),a.x1=a.x1||Math.max(e[0],e[1]),c?(a.temp=a.y0,a.y0=a.y1||Math.min(k[0],k[1]),a.y1=a.temp||Math.max(k[0],k[1]),delete a.temp):(a.y0=a.y0||Math.min(k[0],k[1]),a.y1=a.y1||Math.max(k[0],k[1])),d={x0:this.x.invert(a.x0-this._pad[3]-s.left),y0:this.y.invert(a.y1-this._pad[0]-
s.top),x1:this.x.invert(a.x1-this._pad[3]-s.left),y1:this.y.invert(a.y0-this._pad[0]-s.top)}):"graph"===b&&(a.x0=a.x0||Math.min(l[0],l[1]),a.x1=a.x1||Math.max(l[0],l[1]),a.y0=a.y0||Math.min(h[0],h[1]),a.y1=a.y1||Math.max(h[0],h[1]),d=a);return d},mapDataAreaToRect:function(a,b){var c=b?{top:0,left:0}:this.svg.jq().offset(),d=this.x.range(),e=this.y.range();return{x0:(a.x0?this.x(a.x0):Math.min(d[0],d[1]))+c.left+this._pad[3],x1:(a.x1?this.x(a.x1):Math.max(d[0],d[1]))+c.left+this._pad[3],y0:(a.y0?
this.y(a.y0):Math.max(e[0],e[1]))+c.top+this._pad[0],y1:(a.y1?this.y(a.y1):Math.min(e[0],e[1]))+c.top+this._pad[0]}},handleTickEvent:function(a){if("mouseout"===a.type)this.highlight(!1);else{var b=$(a.currentTarget).data("index");b!==r&&this.data[b]&&("click"===a.type&&this.rects?this.itemClicked(this.data[b],this.rects[0][b]):this.highlight(this.svg.selectAll(".gfx-id-"+this.data[b].id)))}},bindTickEvents:function(){this.$ordinal.on("mouseover mouseout click",".gfx-lnk",this._tickHandler||(this._tickHandler=
$.proxy(this.handleTickEvent,this)));this.$ordinal.find("img").on("error",c)},getOrdinalTicks:function(){var a=this,b='<div class="gfx-ord-tx">';a.data.forEach(function(c,d){c=c||{};var e=a.hasImg&&!a.rotate?(c.img||{}).src:null;b+='<div class="gfx-ord-tick gfx-lnk" data-index="'+d+'">'+(e?'<div class="gfx-ord-img"><img src="'+e+'"/></div>':"")+'<div class="gfx-ord-text">'+c.t+"</div></div>"});var c=$(b+"</div>");a.rotate&&c.addClass("gfx-ord-rotate");return c},resizeOrdinal:function(){var a=this.$ordinal,
b=a.find("img"),c=this.tickFontSize,d,e,k=this.odata.length;e=this.rotate?this.ih||this.h:this.iw||this.w;var l=Math.floor(k/Math.min(k,Math.floor(e/80))),h=1<l&&b.length,s=e/a.text().length,c=c-((5>s)+(3>s)),n=Math.floor(e/(k+0.08)),s=Math.round((e-(k-0.08)*n)/2);this.rotate?(d=Math.min(a.outerWidth(),0.4*this.w),a.width(d),a.children().css({height:n}),a.find(".gfx-ord-text").css({lineHeight:n+"px",fontSize:c})):(d=n,a.width(e-2*s),a.toggleClass("gfx-ord-imgonly",!!h),a.children().each(function(a){a=
0===a%l&&(a+1)/l<=Math.floor(k/l);$(this).css({width:d,fontSize:c}).toggleClass("gfx-ord-hide",!h&&!a)}));e=Math.min(80,d);b.css({maxWidth:e,maxHeight:e});a.find(".gfx-ord-img").height(e);a.css({top:this.pad[0]+(this.rotate?s:this.ih+this.lblPad),left:this._pad[3]+(this.rotate?-d-this.lblPad:s/2)})},getInnerPad:function(){var a,b=this.ts=this.getTickSize(),c=this.ls=this.getLabelSize(),d=this.gs=this.getLegendSize(),e=[];for(a=0;4>a;a++)e.push(b[a]+d[a]+(c[a]?c[a]+this.lblPad:0)+this.pad[a]);return this._pad=
e},resize:function(){this.resizeFonts();this.grid.classed("gfx-msr",!0);this.resizeScales(this.w,this.h);this.updateAxis(this.rotate?"x":"y");var a=this.getInnerPad();this.rotate?this.ih=Math.floor(this.h-a[0]-a[2]):this.iw=Math.floor(this.w-a[1]-a[3]);this.updateAxis(this.rotate?"y":"x");if(this.rotate&&this.ordinalAxis){var b=this.odata.length*this.tickFontSize*1.5;b>this.ih&&(this.h=b,this.ih=b-a[0]-a[2],this.$ele.height(b));500<b&&(this.w-=20,this.$ele.parent().height(500).css("overflow-y","auto"))}a=
this.getInnerPad();this.rotate?this.iw=this.w-a[1]-a[3]:this.ih=this.h-a[0]-a[2];this.svg&&this.svg.attr("width",this.w).attr("height",this.h);this.grid.classed("gfx-msr",!1);this.resizeScales(this.iw,this.ih);this.xxs.tickSize(-this.ih);this.yxs.tickSize(-this.iw);this.updateAxis("x").updateAxis("y");this.grid.attr("transform","translate("+a[3]+","+a[0]+")");this.xtx.attr({transform:"translate(0,"+this.ih+")"});this.xlbl.attr({transform:"translate("+Math.floor(this.iw/2)+","+(this.ih+this.ts[2]+
this.lblPad+1.2*this.tickFontSize)+")"});this.ylbl.select("text").attr({x:Math.floor(this.ih/-2),y:-(this.ts[3]+2*this.lblPad+2)});return this},resizeScales:function(a,b){var c=this.x,d=this.y;this.rotate&&(a=[b,b=a][0],c=[d,d=c][0]);this.ordinal&&this.o.rangeRoundBands([0,a],0.08);this.ordinalAxis?c.rangeRoundBands([0,a],0.08):c.range([0,a]);d.range([b,0])},resizeFonts:function(){this.fontScale||(this.fontScale=e.scale.linear().clamp(!0).domain([600,2E3]).rangeRound([13,20]));var a=this.tickFontSize=
this.fontScale(Math.min(this.h,this.w)),b=this;$.each(["xtx","ytx","xlbl","ylbl"],function(c,d){b[d].style("font-size",Math.floor(a)+"px")})},setDomains:function(){var a=this.x,b=this.y;this.rotate&&(a=[b,b=a][0]);this.ordinal&&this.o.domain(e.range(this.odata.length));if(this.ordinalAxis)a.domain(this.o.domain());else if(this.timeAxis){var c=this.odata;1===c.length&&(c=k(c[0]));a.domain(e.extent(c))}else c=e.extent(this.data,function(a){return a.t}),a.domain([Math.max(c[0],0),c[1]]);var a=this.extent.slice(0),
d=a[0],p=a[1];0===this.stack&&(a=[0<d?0:d,0>p?0:p]);c=this.getRangeMax();a[0]||a[1]?2!==this.stack&&(d=0.5-(p-d)/(a[1]-a[0])*0.4,a[0]-=Math.abs(a[0]*d),c||(a[1]+=Math.abs(a[1]*d))):a=[-1,1];this.rotate&&(a=a.reverse());b.domain(a);return this},getRangeMax:function(){var a=this.getVisibleRangeFields();if(a){this.setMergeTicks(a);var a=this.comp.head[a[0]],b;if("_urr_avg_rating"===a)b=5;else if("expert_rating"===a||"auto_ratings"===a||0<=(this.txPref+this.txSuff).indexOf("%"))b=100;return b}},tickFormat:function(a){var b=
2>=this.txPref.length?this.txPref:"",c=2>=this.txSuff.length?this.txSuff:"",d=e.format(this.txCommas?",s":"");if("edit"===this.txControlType&&"year"===this.txDataType||"date"===this.txControlType)return a;a=parseFloat(a.toFixed(10),10);a=d(a);n.test(a)&&(a=a.replace(n,"B"));return this.normalizeValue(a,b,c)}});c=function(){this.parentNode&&this.parentNode.removeChild(this)};d=function(a,b,c){c=c.map(function(c){return a[c][b]}).filter(function(a,b,c){return c.indexOf(a)===b});return 1<c.length?"":
c[0]};b=function(){return[[e.time.format("%Y"),function(){return!0},365],[e.time.format("%b"),function(a){return a.getMonth()},30],[e.time.format("%b %d"),function(a){return 1!==a.getDate()},24],[e.time.format("%I %p"),function(a){return a.getHours()},60],[e.time.format("%I:%M"),function(a){return a.getMinutes()},60],[e.time.format(":%S"),function(a){return a.getSeconds()},1E3],[e.time.format(".%L"),function(a){return a.getMilliseconds()},1]]};k=function(b){for(var c=[],d=1,e=a.length-1,k=a[e];!k[1](b);)d*=
k[2],k=a[--e];d*=k[2];$.each([-1,1],function(){c.push((new Date).setTime(b.getTime()+this*d))});return c};h.AxisGraph=l})(window);
(function(h,r){var e,n=h.AxisGraph.extend({init:function(a){var b={gfxClass:"gfx-sp",showLegend:0};$.extend(b,a);this._super(b);e=h.d3;this.r=e.scale.linear().clamp(!0);this.setData();return this},build:function(){this._super();this.bestFitLine=this.grid.append("line").classed("gfx-bf",!0);return this},update:function(a){if(!1===this._super())return!1;a=a||{};var b=this,c=this.groups,d=a.prepare,k=!1!==a.animate;a=b.points=b.grid.selectAll(".gfx-sp-point").data(b.data,function(a){return a.id});a.enter().append("circle").attr({"class":"gfx-sp-point",
cx:b.iw/2,cy:b.ih/2,r:0.01}).each(function(a){e.select(this).classed("gfx-id-"+a.id,!0)}).on("mouseover",function(a){b.highlight(e.select(this));b.highlightTable(a.id)}).on("mouseout",function(){b.highlight(!1)}).on("click",function(a){b.itemClicked.apply(b,[a,this])});a.exit().remove();d||a.each(function(a){e.select(this).style({fill:0<=b.colorIndex?b.getColorForValue(a.c):b.c[0]}).trans(k?1E3:0).attr({cx:b.x(a.d[0]),cy:b.y(a.d[1]),r:b.r(a.d[2]||0)})});for(var l={},f,d=0;d<c.length;d++)for(f=0;f<
c[d].ids.length;f++)l[c[d].ids[f]]=c[d].color;a.sort(function(a,c){var d=l[b.inverseIdMap[a.id]],e=l[b.inverseIdMap[c.id]];return d===e?0:d>e?-1:1}).filter(function(a){return!!l[b.inverseIdMap[a.id]]}).style("fill",function(a){return l[b.inverseIdMap[a.id]]});this.setBestFit()},getAxisTpl:function(a){return[this.isPrimaryAxis(a)?this.series[0]:this.series[1]]},getPopContent:function(a){var b=this,c=a.data()[0],d=b.comp,e;if(!c)return null;e={t:c.t,v:[],c:a.fill()};this.series.forEach(function(a,f){e.v.push([d.defs[a].name,
b.getPopValue(a,c.d[f])])});return e},setData:function(a){if(!1===this._super(a))return!1;this.setColors().setDomains();this.resize();return this},setBestFit:function(){this.bestFitLine.jq().showIf(this.bestFit);if(!this.bestFit)return this;for(var a=0,b=0,c=0,d=0,e=this.data.length,l=this.x.domain(),f=this.y.domain(),g={},q=0,h;q<e;q++)h=this.data[q],a+=h.d[0],b+=h.d[1],c+=h.d[0]*h.d[0],d+=h.d[0]*h.d[1];c=(d-a*b/e)/(c-a*a/e);a=b/e-c*a/e;for(q=0;2>q;q++)b=l[q]*c+a,b<=f[1]&&b>=f[0]?g["x"+(q+1)]=this.x(l[q]):
(b=b>f[1]?f[1]:f[0],g["x"+(q+1)]=this.x((b-a)/c)),g["y"+(q+1)]=this.y(b);this.bestFitLine.front().attr(g).style({stroke:this.c[0]});return this},resize:function(){this._super();this.r.rangeRound([5,9]);return this},setDomains:function(){var a=this;$.each(["x","y"],function(b,d){var k=e.extent(a.data,function(a){return a.d[b]});a[d].domain([k[0]-0.05*(k[1]-k[0]),k[1]+0.05*(k[1]-k[0])])});if(2<a.series.length){var b=e.extent(a.data,function(a){return a.d[2]});a.r.domain(b)}else a.r.domain([0,0]);return this}});
h.ScatterGraph=n})(window);
(function(h,r){var e,n=h.AxisGraph.extend({init:function(a){var b={gfxClass:"gfx-bar",pad:[20,20,15,15],stack:0,ordinal:1};$.extend(b,a);this._super(b);e=h.d3;this.o=e.scale.ordinal();this.setData();return this},build:function(){this._super();this.svg.classed("gfx-bar-h",!!this.rotate);this.svg.classed("gfx-bar-v",!this.rotate);return this},update:function(a){if(!1===this._super())return!1;a=a||{};var b,c,d=this,k=a.prepare,l=!1!==a.animate,f=this.groups,g=d.o,h=d.rotate,m=h?d.x:d.y,p=m(0),n=d.isGroup()?
d.ldata.length:1,r=g.rangeBand(),t=n+0.1*(n-1);a=Math.min(Math.floor(r/t),40);var s=Math.floor((r-a*t)/2),r=Math.ceil(0.1*a),x=a+r,v=[],r=d.isGroup()?function(a){if(null===a.y)return 0;v[a.x]=(v[a.x]||0)+1;var b=n-d.nonNulls(a.x),b=Math.floor(b*x/2);return g(a.x)+s+(v[a.x]-1)*x+b}:function(a){return g(a.x)+s},t=d.layers=d.grid.selectAll(".gfx-layer").data(d.ldata,function(a){return a[0].c});t.enter().append("g").attr("class","gfx-layer");t.exit().remove();var u=d.rects=t.selectAll(".gfx-bar-point").data(function(a){return a},
function(a){return a.id}),y=u.enter().append("rect").classed("gfx-bar-point",!0).each(function(a){e.select(this).classed("gfx-id-"+a.id,!0)}).on("mouseover",function(a){d.highlight(e.select(this));d.highlightTable(a.id)}).on("mouseout",function(){d.highlight(!1)});y.on("click",function(a){d.itemClicked.apply(d,[a,this])});var z={};for(b=0;b<f.length;b++)for(c=0;c<f[b].ids.length;c++)z[f[b].ids[c]]=f[b].color;u.style("fill",function(a){return z[d.inverseIdMap[a.id]]||""});y.attr({x:h?p:r,y:h?r:p,width:h?
0:a,height:h?a:0});k||(v=[],k=l?u.trans(1E3,30):u,d.rotate?k.attr({x:d.isGroup()?function(a){return 0>a.y?m(a.y):p}:function(a){return m(a.y0)},y:r,width:function(a){return Math.abs(m(a.y)-p)},height:a}):k.attr({x:r,y:d.isGroup()?function(a){return 0>a.y?p:m(a.y)}:function(a){return m(a.y0+a.y)},width:a,height:d.isGroup()?function(a){return Math.abs(m(a.y)-p)}:function(a){return m(a.y0)-m(a.y0+a.y)}}));u.exit().remove();this.colorize(t);return this},mapDataAreaToRect:function(a,b){var c=b?{top:0,
left:0}:this.svg.jq().offset(),d=this.x.range(),e=this.y.range();return{x0:(a.x0?this.x(a.x0):Math.min(d[0],d[1]))+c.left+this._pad[3],x1:(a.x1?this.x(a.x1+1):Math.max(d[0],d[1]))+c.left+this._pad[3],y0:Math.max(e[0],e[1])+c.top+this._pad[0],y1:Math.min(e[0],e[1])+c.top+this._pad[0]}},setData:function(a){if(!1===this._super(a))return!1;this.setDataCommon();this.resize();return this},nonNulls:function(a){a=this.data[a];a.nonNull===r&&(a.nonNull=_.filter(a.d,_.isNumber).length);return a.nonNull}});
h.BarGraph=n})(window);
(function(h,r){var e,n=h.AxisGraph.extend({isArea:!1,mouseOut:!0,points:null,ptSelection:null,ordinalOffsetX:0,gridOffsetX:0,gridOffsetY:0,init:function(a){var b={stack:0,gfxClass:"gfx-line",parseOrdinalDate:!0,ordinal:1};$.extend(b,a);this._super(b);e=h.d3;this.isArea=a.area||!1;this.setData();return this},build:function(){this._super();var a=this,b=_.throttle(a.handleMouse,50,!0);this.svg.on("mousemove",function(){var c=e.mouse(this);b(a,c)});this.svg.jq().on("mouseleave",function(){a.mouseOut=
!0;a.highlight(!1);a.ptSelection=null;e.select(".gfx-highlight").classed("gfx-highlight",!1)});return this},highlight:function(a){this.pop.p&&this.pop.p.attr("r",this.ptRadius);a&&a.attr("r",5);this._super(a)},handleMouse:function(a,b){if(a.mouseOut)a.mouseOut=!1;else if(a.ldata.length){var c;if(a.isGroup())c=a.getClosestPoint(a.points,b),a.selectLine(c),c=e.select(c);else{if(!a.ptSelection)return;c=e.select(a.getClosestPoint(a.ptSelection,b))}c&&!c.classed("gfx-sel")&&(e.select(".gfx-sel").classed("gfx-sel",
!1),a.highlight(c))}},selectLine:function(a){if(a){var b=e.select(a.parentNode);this.ptSelection=b.selectAll("circle");e.select(".gfx-highlight").classed("gfx-highlight",!1);this.points.classed("gfx-sel",!1);b.classed("gfx-highlight",!0);a=$(a).parent();b=a.parent();a.remove();b.append(a)}},update:function(a){if(!1===this._super())return!1;a=a||{};var b=this,c=a.prepare,d=!1!==a.animate,k,l,f,g;this.ordinalOffsetX=b.ordinalAxis?b.o.rangeBand()/2:0;var h=b.layers=this.grid.selectAll(".gfx-layer").data(b.ldata,
function(a){return a[0].c});h.enter().append("g").classed("gfx-layer",!0).classed("gfx-ln-stack",!b.isGroup());h.exit().remove();b.isGroup()&&(k=h.selectAll(".gfx-ln-path").data(function(a){return[a]},function(a){return a[0].c}),l=k.enter().append("path").classed("gfx-ln-path",!0).on("mouseover",function(){b.selectLine(this)}),k.exit().remove(),f=function(a){return b.x(b.ordinalAxis?a.x:b.odata[a.x])+b.ordinalOffsetX},g=b.isGroup()?function(a){return b.y(a.y)}:function(a){return b.y(a.y+a.y0)},l.attr("d",
e.svg.line().x(f).y(b.ih)));this.points=h.selectAll(".gfx-ln-point").data(function(a){return a});var m=this.points.enter().append("circle").classed("gfx-ln-point",!0).on("mouseover",function(){b.selectLine(this)});m.on("click",function(a){b.itemClicked.apply(b,[a,this])});l=function(a){return b.x(b.ordinalAxis?a.x:b.odata[a.x])+b.ordinalOffsetX};m.attr("cy",b.ih).attr("r",0).each(function(a){e.select(this).classed("gfx-id-"+a.id,!0)});this.points.exit().remove();this.isArea&&this.areaUpdate(a,h);
c?this.points.attr("cx",l):(k&&k.trans(d?1E3:0).attr("d",e.svg.line().x(f).y(g)),a=this.ptRadius=(this.points.length?e.max(this.points,_.size):0)>this.iw/30?0:5,this.points.trans(d?1E3:0).attr({r:a,cx:l,cy:b.isGroup()?function(a){return b.y(a.y)}:function(a){return b.y(a.y+a.y0)}}));this.colorize(h)},colorize:function(a){var b=this;b._super(a);a&&a.attr("stroke",function(a){return b.c[a[0].c]})},getClosestPoint:function(a,b){var c=this,d=b[0]-this.gridOffsetX,e=b[1]-this.gridOffsetY,h,f=-1,g,q,m;
a.each(function(a){q=Math.abs(c.x(c.ordinalAxis?a.x:c.odata[a.x])+c.ordinalOffsetX-d);m=Math.abs(e-c.y(a.y));if(-1===f||q<f||q===f&&m<g)h=this,f=q,g=m});return h},setData:function(a){if(!1===this._super(a))return!1;this.setDataCommon();this.resize()},resize:function(){this._super();var a=this.grid[0][0].transform.baseVal.getItem(0);a.type===h.SVGTransform.SVG_TRANSFORM_TRANSLATE&&(this.gridOffsetX=a.matrix.e,this.gridOffsetY=a.matrix.f);return this},areaUpdate:function(a,b){var c=this,d=a.prepare,
h=!1!==a.animate,l=b.selectAll(".gfx-ln-area").data(function(a){return[a]},function(a){return a[0].c}),f=function(a){return c.x(c.ordinalAxis?a.x:c.odata[a.x])+c.ordinalOffsetX},g=l.enter().append("path").attr("class","gfx-ln-area").attr("d",e.svg.area().x(f).y0(c.ih).y1(c.ih));l.exit().remove();if(!c.isGroup())g.on("mouseover",function(){c.selectLine(this)});l&&!d&&l.trans(h?1E3:0).attr("d",e.svg.area().x(f).y0(c.isGroup()?this.ih:function(a){return c.y(a.y0)}).y1(c.isGroup()?function(a){return c.y(a.y)}:
function(a){return c.y(a.y+a.y0)}))}});h.LineGraph=n})(window);
